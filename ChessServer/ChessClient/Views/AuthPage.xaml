<?xml version="1.0" encoding="utf-8" ?>
<!-- Добавьте в начало AuthPage.xaml -->
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ChessClient.Views.AuthPage"
             xmlns:viewmodels="clr-namespace:ChessClient.ViewModels"
             xmlns:converters="clr-namespace:ChessClient.Utilities.Converters"
             x:DataType="viewmodels:AuthViewModel"
             Title="Вход">
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- BoolToColorConverter -->
            <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>

            <!-- BoolToStringConverter -->
            <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>

            <!-- StringIsNotNullOrEmptyConverter -->
            <converters:StringIsNotNullOrEmptyConverter x:Key="StringIsNotNullOrEmptyConverter"/>

            <!-- InverseBoolConverter -->
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>

            <converters:BoolToCommandConverter x:Key="BoolToCommandConverter"/>

        </ResourceDictionary>
    </ContentPage.Resources>
    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            <!-- Switch between Login/Register -->
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="20">
                <Button Text="Вход" 
                        Command="{Binding ShowLoginCommand}"
                        BackgroundColor="{Binding IsRegisterMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Transparent;#512BD4'}" 
                        TextColor="{Binding IsRegisterMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#000000;#FFFFFF'}" />

                <Button Text="Регистрация" 
                        Command="{Binding ShowRegisterCommand}"
                        BackgroundColor="{Binding IsRegisterMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#512BD4;Transparent'}" 
                        TextColor="{Binding IsRegisterMode, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFFFFF;#000000'}" />
            </StackLayout>

            <!-- Auth Form -->
            <Frame Padding="15" CornerRadius="10" HasShadow="True">
                <StackLayout Spacing="15">
                    <Label Text="{Binding IsRegisterMode, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Регистрация;Вход'}" 
                           FontSize="Title" HorizontalOptions="Center" />

                    <!-- Username -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Логин" FontAttributes="Bold" />
                        <Entry Text="{Binding Username}" Placeholder="Введите логин" />
                    </VerticalStackLayout>

                    <!-- Password -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Пароль" FontAttributes="Bold" />
                        <Entry Text="{Binding Password}" Placeholder="Введите пароль" IsPassword="True" />
                    </VerticalStackLayout>

                    <!-- Repeat password-->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Повторите пароль" FontAttributes="Bold" />
                        <Entry Text="{Binding RepeatedPassword}" 
                               Placeholder="Повторите пароль" 
                               IsPassword="True"
                               IsVisible="{Binding IsRegisterMode}"/>
                    </VerticalStackLayout>
                    
                    <!-- Error Message -->
                    <Label Text="{Binding ErrorMessage}" 
                           TextColor="Red" 
                           IsVisible="{Binding ErrorMessage, Converter={StaticResource StringIsNotNullOrEmptyConverter}}" />

                    <!-- Submit Button -->
                    <Button Text="{Binding IsRegisterMode, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Зарегистрироваться;Войти'}" 
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            BackgroundColor="#512BD4" TextColor="White" 
                            Command="{Binding LoginCommand}">
                        <Button.Triggers>
                            <DataTrigger 
                                TargetType="Button"
                                Binding="{Binding IsRegisterMode}"
                                Value="True">   
                                <Setter Property="Command" Value="{Binding RegisterCommand}" />
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>

                    <!-- Loading Indicator -->
                    <ActivityIndicator IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" />
                </StackLayout>
            </Frame>
        </StackLayout>
    </ScrollView>
</ContentPage>